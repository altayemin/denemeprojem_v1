<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Canlı Veri Görselleştirme</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 10px; padding: 10px; font-size: 16px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
  </style>
</head>
<body>

  <h1>Canlı Sıcaklık ve Nem Verileri</h1>

  <button onclick="startUpdates()">Başlat</button>
  <button onclick="stopUpdates()">Durdur</button>
  <button onclick="fetchData()">Veriyi Güncelle</button>

  <canvas id="myChart" width="600" height="300"></canvas>

  <table id="data-table">
    <thead>
      <tr>
        <th>Zaman</th>
        <th>Sıcaklık (°C)</th>
        <th>Nem (%)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let chart;
    let updateInterval;

    function setupChart() {
      const ctx = document.getElementById("myChart").getContext("2d");
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "Sıcaklık (°C)",
              data: [],
              borderColor: "red",
              fill: false
            },
            {
              label: "Nem (%)",
              data: [],
              borderColor: "blue",
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            x: { title: { display: true, text: 'Zaman' } },
            y: { beginAtZero: false }
          }
        }
      });
    }

    async function fetchData() {
      try {
        const response = await fetch("veri.json");
        const data = await response.json();
        updateDisplay(data);
      } catch (e) {
        console.error("Veri alınamadı:", e);
      }
    }

    function updateDisplay(data) {
      const tbody = document.querySelector("#data-table tbody");
      tbody.innerHTML = "";

      const labels = [];
      const temp = [];
      const hum = [];

      data.forEach(row => {
        const [time, tempVal, humVal] = row;
        labels.push(time);
        temp.push(parseFloat(tempVal));
        hum.push(parseFloat(humVal));

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${time}</td><td>${tempVal}</td><td>${humVal}</td>`;
        tbody.appendChild(tr);
      });

      chart.data.labels = labels;
      chart.data.datasets[0].data = temp;
      chart.data.datasets[1].data = hum;
      chart.update();
    }

    function startUpdates() {
      fetchData();
      updateInterval = setInterval(fetchData, 5000);
    }

    function stopUpdates() {
      clearInterval(updateInterval);
    }

    setupChart();
  </script>
</body>
</html>


