<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Canlı Veri Takibi</title>
  <style>
    body { font-family: Arial; text-align: center; margin: 40px; }
    .data-box, .list-box {
      border: 2px solid #333;
      padding: 20px; border-radius: 10px; background: #f2f2f2; margin-bottom: 20px;
      display: inline-block;
    }
    ul { max-height: 300px; overflow-y: auto; text-align: left; padding: 0 20px; list-style: none; }
    li { margin: 5px 0; font-family: monospace; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>

  <h1>Canlı Sıcaklık ve Nem Takibi</h1>

  <button onclick="startExperiment()">Deneyi Başlat</button>
  <button onclick="stopExperiment()">Deneyi Durdur</button>

  <div class="data-box">
    <h2>Son Veri</h2>
    <p><strong>Zaman:</strong> <span id="time">-</span></p>
    <p><strong>Sıcaklık:</strong> <span id="temp">-</span> °C</p>
    <p><strong>Nem:</strong> <span id="humidity">-</span> %</p>
  </div>

  <div class="list-box">
    <h3>Veri Listesi</h3>
    <ul id="dataList"></ul>
  </div>

  <script>
    const jsonURL = "https://spreadsheets.google.com/feeds/list/1qWH2IfH7C5YPLt8xhD2uxD1JlfwZnfazXtIuhxhZ5CU/od6/public/values?alt=json";

    let intervalID = null;
    let lastTimestamp = "";

    async function fetchData() {
      try {
        const res = await fetch(jsonURL);
        const json = await res.json();
        const entries = json.feed.entry;

        if (entries && entries.length > 0) {
          const lastEntry = entries[entries.length - 1];

          const time = lastEntry.gsx$zaman.$t;
          const temp = lastEntry.gsx$sicaklik.$t;
          const hum  = lastEntry.gsx$nem.$t;

          if (time !== lastTimestamp) {
            lastTimestamp = time;

            document.getElementById("time").textContent = time;
            document.getElementById("temp").textContent = temp;
            document.getElementById("humidity").textContent = hum;

            const li = document.createElement("li");
            li.textContent = `Zaman: ${time} | Sıcaklık: ${temp} °C | Nem: ${hum} %`;
            document.getElementById("dataList").appendChild(li);
          }
        }
      } catch (e) {
        console.error("Veri çekilirken hata oluştu:", e);
      }
    }

    function startExperiment() {
      if (!intervalID) {
        fetchData(); // İlk veriyi hemen getir
        intervalID = setInterval(fetchData, 5000); // Her 5 saniyede bir kontrol et
      }
    }

    function stopExperiment() {
      clearInterval(intervalID);
      intervalID = null;
    }
  </script>

</body>
</html>






