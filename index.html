<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Raspberry Pi Sensör Paneli</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      padding: 20px;
    }
    .column {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 48%;
    }
    .bottom-row {
      display: flex;
      justify-content: space-between;
      width: 100%;
      padding: 0 20px;
      margin-top: 30px;
    }
    .chart-box {
      background: #fff;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .chart-label {
      text-align: center;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .value-box {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #f44336;
      color: #fff;
      padding: 2px 6px;
      font-size: 12px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="column" id="temperatureColumn"></div>
    <div class="column" id="humidityColumn"></div>
  </div>
  <div class="bottom-row">
    <div class="chart-box" style="width: 48%">
      <div class="chart-label">Hava Hızı (HS1)</div>
      <canvas id="chartHS1"></canvas>
    </div>
    <div class="chart-box" style="width: 48%">
      <div class="chart-label">Su Debisi (SD1)</div>
      <canvas id="chartSD1"></canvas>
    </div>
  </div>

  <script>
    const chartRefs = {};
    const latestValues = {};

    const createChart = (ctxId, label, color) => {
      const ctx = document.getElementById(ctxId).getContext("2d");
      return new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [{
            label: label,
            data: [],
            borderColor: color,
            backgroundColor: color + '33',
            tension: 0.2,
            fill: true
          }]
        },
        options: {
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: context => `${label}: ${context.raw}`
              }
            }
          },
          scales: {
            x: { display: false },
            y: { beginAtZero: true }
          }
        }
      });
    };

    const drawCharts = () => {
      const tempCol = document.getElementById("temperatureColumn");
      const humCol = document.getElementById("humidityColumn");

      for (let i = 1; i <= 8; i++) {
        tempCol.innerHTML += `
          <div class="chart-box">
            <div class="chart-label">T${i}</div>
            <canvas id="chartT${i}"></canvas>
          </div>`;
        chartRefs[`T${i}`] = createChart(`chartT${i}`, `T${i}`, "#e53935");

        humCol.innerHTML += `
          <div class="chart-box">
            <div class="chart-label">H${i}</div>
            <canvas id="chartH${i}"></canvas>
          </div>`;
        chartRefs[`H${i}`] = createChart(`chartH${i}`, `H${i}`, "#1e88e5");
      }
      chartRefs["HS1"] = createChart("chartHS1", "HS1", "#43a047");
      chartRefs["SD1"] = createChart("chartSD1", "SD1", "#fb8c00");
    };

    const updateCharts = (data) => {
      const last = data[data.length - 1];

      Object.keys(last).forEach((key) => {
        if (chartRefs[key]) {
          const chart = chartRefs[key];
          chart.data.labels.push(last.zaman);
          chart.data.datasets[0].data.push(last[key]);
          if (chart.data.labels.length > 20) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
          }
          chart.update();
        }
      });
    };

    const fetchData = async () => {
      try {
        const res = await fetch("https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec");
        const data = await res.json();
        updateCharts(data);
      } catch (err) {
        console.error("Veri alınamadı:", err);
      }
    };

    drawCharts();
    fetchData();
    setInterval(fetchData, 15000); // 15 saniyede bir güncelle
  </script>
</body>
</html>

