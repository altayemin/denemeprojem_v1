<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Canlı Veri Görselleştirme</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 10px; padding: 10px; font-size: 16px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
  </style>
</head>
<body>

  <h1>Canlı Sıcaklık ve Nem Verileri</h1>

  <button onclick="startUpdates()">Başlat</button>
  <button onclick="stopUpdates()">Durdur</button>
  <button onclick="fetchData()">Veriyi Güncelle</button>

  <canvas id="myChart" width="600" height="300"></canvas>

  <table id="data-table">
    <thead>
      <tr>
        <th>Zaman</th>
        <th>Sıcaklık (°C)</th>
        <th>Nem (%)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let chart;
    let updateInterval;

    // Başlangıç verileri için boş grafik
    function setupChart() {
      const ctx = document.getElementById("myChart").getContext("2d");
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "Sıcaklık (°C)",
              data: [],
              borderColor: "red",
              fill: false
            },
            {
              label: "Nem (%)",
              data: [],
              borderColor: "blue",
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            x: { display: true, title: { display: true, text: 'Zaman' } },
            y: { beginAtZero: true }
          }
        }
      });
    }

    // HTML tablo ve grafiği güncelle
    function updateDisplay(data) {
      const tbody = document.querySelector("#data-table tbody");
      tbody.innerHTML = "";

      const labels = [];
      const temperature = [];
      const humidity = [];

      data.forEach(row => {
        const [zaman, sicaklik, nem] = row;
        labels.push(zaman);
        temperature.push(parseFloat(sicaklik));
        humidity.push(parseFloat(nem));

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${zaman}</td><td>${sicaklik}</td><td>${nem}</td>`;
        tbody.appendChild(tr);
      });

      chart.data.labels = labels;
      chart.data.datasets[0].data = temperature;
      chart.data.datasets[1].data = humidity;
      chart.update();
    }

    // Google Sheets verisini çeken fonksiyon (statik sayfada örnek veriyle çalışıyor)
    async function fetchData() {
      const response = await fetch("veri.json"); // Python script'in oluşturduğu JSON dosyası
      const data = await response.json();
      updateDisplay(data);
    }

    function startUpdates() {
      fetchData();
      updateInterval = setInterval(fetchData, 5000); // 5 saniyede bir güncelle
    }

    function stopUpdates() {
      clearInterval(updateInterval);
    }

    setupChart(); // Sayfa yüklenince grafik hazırla
  </script>
</body>
</html>










